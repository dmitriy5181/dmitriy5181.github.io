<!DOCTYPE html>
<html lang="en"><title>Work with I2C on Raspberry Pi | // pragmatic engineering</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.79.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://blog.prgm.xyz/css/index.css">
<link rel="stylesheet" href="https://blog.prgm.xyz/css/classes.css">
<link rel="canonical" href="https://blog.prgm.xyz/post/i2c-raspberry-py/">
<link rel="alternate" type="application/rss+xml" href="" title="// pragmatic engineering">

<body>

<header class="icons">
  
    <a href="https://blog.prgm.xyz">// pragmatic engineering</a>
  
  
  
</header>

<article>
  <header>
    <h1>Work with I2C on Raspberry Pi</h1>
    <time datetime="2020-03-08T00:00:00Z">March 08, 2020</time>
  </header>
  <p>Article is describing basic steps on how to start working with an I2C device. The end goal is a simple LED clock.
Everything was done on the Raspbian &ldquo;Buster&rdquo; with using Adafruit 4-Digit 7-Segment Display.</p>
<p>Essential links:</p>
<ul>
<li><a href="https://www.kernel.org/doc/html/latest/i2c/dev-interface.html">Implementing I2C device drivers in userspace</a> - basics on how to work with I2C in Linux</li>
<li><a href="https://git.kernel.org/pub/scm/utils/i2c-tools/i2c-tools.git">i2c-tools</a> - user-space library and command line tools</li>
<li><a href="https://www.adafruit.com/product/1270">Adafruit 1.2&quot; 4-Digit 7-Segment Display w/I2C Backpack</a> - information about used LED display</li>
</ul>
<p>First, enable I2C:</p>
<pre><code>$ sudo raspi-config nonint do_i2c 0
</code></pre><p>Then install needed use-space tools and library:</p>
<pre><code>$ sudo apt install i2c-tools libi2c-dev
</code></pre><p>Run next command to check that LED display is connected (default address is 0x70):</p>
<pre><code>$ sudo i2cdetect -y 1                     
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
70: 70 -- -- -- -- -- -- --
</code></pre><p>Simple communication with the display can be done with the help of <code>i2cget</code> and <code>i2cset</code> tools.
Adafruit LED display is using HT16K33 as a driver and addresses and values of its internal registers can be found in the datasheet.
In addition, source code of the <code>i2c-tools</code> can be used as an example on how to read and write data. For example to turn display on:</p>
<pre><code>$ sudo i2cset -y 1 0x70 0x81
</code></pre><p>Below is the resulting source code of the program which reads system time and shows it on the display.
To compile it:</p>
<pre><code>$ g++ ledclock.cpp -li2c -o ledclock
</code></pre><p>Simple way to run it in background:</p>
<pre><code>$ dtach -n /tmp/ledclock ./ledclock
</code></pre><p>Source code:</p>
<script type="application/javascript" src="https://gist.github.com/dmitriy5181/a349a9d803dbc34bd254d8215774828f.js"></script>


</article>



</body>

</html>
